Steps to Release a New Version of SNAP
Oct 2, 2012

# update the versions here for the current update
OLDVER=1.9.1
NEWVER=1.9.2

#
# prepare the distribution package and the documentation
#

# update release notes RELEASE.txt (MANUAL STEP)
cd $HOME/git/snap; vi RELEASE.txt
git commit -a
git push

# get the latest code release
# TODO add repository cloning the next time to prevent any local work files
#	being in the release
cd $HOME/git/snap
git checkout master
git pull

# make sure to clean up any work files
cd $HOME/git/snap; make clean
cd $HOME/git/snap/doxygen; make clean

#
# build the package
#

# edit VERSION (MANUAL STEP)
cd $HOME/git/snap/utils; vi mksnap.sh
cd $HOME/git/snap/utils; mksnap.sh
# the package will be in
#   $HOME/snaprelease/Snap-${NEWVER}.zip

# build the reference manual
cd $HOME/git/snap/doxygen; make all
# user and developer reference manuals will be in
#   $HOME/git/snap/dowxygen/snapdoc-user,snapdoc-dev

#
# prepare the release web pages
#

# copy the package to the web site
scp $HOME/snaprelease/Snap-${NEWVER}.zip snap@snap:httpd/htdocs/releases

# vvvvv ===== host SNAP ===== vvvvvv
# create the new release directory (host SNAP)
ssh snap@snap
# !!! set OLDVER and NEWVER variables !!!
cd $HOME/httpd/htdocs; cp -a snap-${OLDVER} snap-${NEWVER}

# add the new release to the page (MANUAL STEP)
cd $HOME/httpd/htdocs/snap-${NEWVER}; vi releases.html
cd $HOME/httpd/htdocs/snap-${NEWVER}; vi download.html
# ^^^^^ ===== host SNAP ===== ^^^^^

# copy doxygen documentation to the web site
cd $HOME/git/snap/doxygen; scp -r snapdoc-dev snapdoc-user snap@snap:httpd/htdocs/snap-${NEWVER}/doc

# vvvvv ===== host SNAP ===== vvvvvv
# remove old reference documentation and rename the new one
ssh snap@snap
cd $HOME/httpd/htdocs/snap-${NEWVER}/doc; rm -rf snapuser-ref snapdev-ref
cd $HOME/httpd/htdocs/snap-${NEWVER}/doc; mv snapdoc-dev snapdev-ref
cd $HOME/httpd/htdocs/snap-${NEWVER}/doc; mv snapdoc-user snapuser-ref

# create a link to the new release
cd $HOME/httpd/htdocs; ln -fsn snap-${NEWVER} snap
# ^^^^^ ===== host SNAP ===== ^^^^^

